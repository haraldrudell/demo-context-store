// test-emailer.js
// Â© 2012 Harald Rudell <harald.rudell@therudells.com> (http://haraldrudell.com) MIT License

var emailer = require('../lib/emailer')

// http://nodejs.org/api/events.html
var events = require('events')
// https://github.com/haraldrudell/mochawrapper
var assert = require('mochawrapper')

exports['Emailer:'] = {
	'Exports': function () {
		assert.exportsTest(emailer, 3)
	},
	'Send SetSendMail HasSendMail': function () {
		var opts = {
			subject: 'SUBJECT',
			body: 'BODY',
		}
		var aSend = 0

		emailer.setSendMail(mockSend)
		assert.ok(emailer.hasSendMail())
		emailer.send(opts)
		assert.equal(aSend, 1)

		function mockSend(opts0, cb) {
			assert.deepEqual(opts0, opts)
			aSend++
		}
	},
}
