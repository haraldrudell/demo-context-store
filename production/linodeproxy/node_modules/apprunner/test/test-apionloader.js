// test-apionloader.js
// Â© 2013 Harald Rudell <harald.rudell@therudells.com> (http://haraldrudell.com) MIT License

var apionloader = require('../lib/apionloader')

var getrequire = require('../lib/getrequire')
var apilist = require('../lib/apilist')

// https://github.com/haraldrudell/mochawrapper
var assert = require('mochawrapper')

var ga = getrequire.getApiData
var gi = apilist.getInitApiName

exports['ApiOnloader:'] = {
	'Exports': function () {
		assert.exportsTest(apionloader)
	},
	'DoOnLoads': function () {
		var api = 'API'

		var aInit = 0
		var testMap = {}
		testMap[api] = {initApi: function mockInitApi() {aInit++}}
		getrequire.testIntercept({testMap: testMap})

		getrequire.getApiData = function mockGetApiData() {return {onloads: [api]}}

		apilist.getInitApiName = function mockGetInitApiName() {return 'initApi'}

		apionloader.doOnLoads(function mockLog() {})

		assert.ok(aInit)
	},
	'after': function () {
		getrequire.testIntercept({testMap: false})
		getrequire.getApiData = ga
		apilist.getInitApiName = gi
	}
}
