<!DOCTYPE html>
<html>
  <head>
    <title>TravellingAgent</title>
    <link rel="Shortcut Icon" href="/favicon.ico" />
    <style type="text/css">

html,body {
    background-color: #000;
    color: #fff;
    font-family: helvetica, arial, sans-serif;
    margin: 0;
    padding: 0;
    font-size: 12pt;
    min-height: 416px;
    position: relative;
}

#bigCanvas {
        -webkit-transform-origin: 0 0;
        -webkit-transform: scale3d(2, 2, 0) translate3d(-100px, 0px, 0);
}

#canvas {
    border: 1px solid red;
    image-rendering: optimizeSpeed;
    /* force nearest neighbor scaling */
	  image-rendering: -moz-crisp-edges; /* firefox */
	  image-rendering: -webkit-optimize-contrast; /* chrome/safari */
	      -ms-interpolation-mode: nearest-neighbor; /* ie */
        -webkit-interpolation-mode: nearest-neighbor;
}

<!-- @media screen and (-webkit-min-device-pixel-ratio:2){ -->
<!--     #canvas { -->
<!--         width: 320px; -->
<!--         height: 320px; -->
<!--     } -->
<!-- } -->

    .navButton {
        background-image: url(media/iphone-buttons.png);
        background-repeat: no-repeat;
        width: 80px;
        height: 50px;
        position: absolute;
        bottom: 0px;
        line-height: 200%;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            -webkit-text-size-adjust: none;
    }
#buttonFPS { position: absolute; top: 0; left: 0; width: 32px; height: 32px; }
#buttonLeft { left: 0; background-position: 0, 0; }
#buttonRight { right: 0px; background-position: -80px, 0; }
#buttonDown { right: 80px; background-position: -160px, 0; }
#buttonUp { left: 80px; background-position: -240px, 0; }

#game {
    text-align: center;
}

    .topNav {
        padding: 10px;
        height:24px;
        text-align:center;
    }

    .btnLink {
        background-color: #ffffff;
        border: 1px solid black;
        padding: 10px;
    }


    .buyButton {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
	          -moz-box-shadow:inset 0px 1px 0px 0px #ffffff;
	          -webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;
	      box-shadow:inset 0px 1px 0px 0px #ffffff;
	      background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ededed), color-stop(1, #dfdfdf) );
	      background:-moz-linear-gradient( center top, #ededed 5%, #dfdfdf 100% );
	      background-color:#ededed;
	          -moz-border-radius:6px;
	          -webkit-border-radius:8px;
	      border-radius:8px;
	      border:1px solid #dcdcdc;
	      display:inline-block;
	      color:#777777;
	      font-family:arial;
	      font-size:15px;
	      font-weight:bold;
	      padding:6px 10px;
	      text-decoration:none;
	      text-shadow:1px 1px 0px #ffffff;
    }.buyButton:hover {
	      background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #cccccc), color-stop(1, #ededed) );
	      background:-moz-linear-gradient( center top, #dfdfdf 5%, #ededed 100% );
	      background-color:#dfdfdf;
    }.buyButton:active {
	      position:relative;
	      top:1px;
    }

    .shopDiv {
        background-color: #444444;
        padding: 10px;
        position: absolute;
        top: 0px;
        width: 100%;
        visibility: hidden;
    }   


    </style>

    <link rel="apple-touch-icon" href="media/touch-icon.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <script type="text/javascript">
    function noScroll() {
        window.scrollTo(0,1);
        // Dont allow scrolling
        document.body.addEventListener('touchmove',
                                       function(event) 
                                       {
                                           event.preventDefault();
                                           // Additionally, this will scroll the screen to 0,0  whenever the 
                                           // user tries to scroll - effectivly hiding  the address bar. 
                                           // This may be a bit irritating for the user?!
                                           window.scrollTo(0,0); 
                                       });
    }


var currentPopup = false;
function buyItem(itemName) {
    console.log("buying: " + itemName);
    ig.game.buildMode(itemName);
    if (currentPopup) {
        popup(currentPopup, false);
    }
    if (callerObj) {
        callerObj.buyItem(itemName);
        callerObj = false;
    }
}

function doUpgrade(flag) {
    //todo - send events to game
    console.log("doUpgrade:" + flag);
    popup("upgrade", false);
}

function goShop() {
    console.log("goShop");
    popup("shop", true);
}

function goUpgrade(tgt) {
    console.log("upgrade");
    popup("upgrade", true);
}

function showDialog() {
    popup("dialog", true)
}

var callerObj;
function popup(wot, flag, caller) {
    if (caller) {
        callerObj = caller;
    }
    if (flag) {
        currentPopup = wot;
    } else {
        currentPopup = false;
    }
    var vis = (flag ? "visible" : "hidden" );
    document.getElementById(wot).style.visibility = vis;
}

function dialogAction(value) {
    //      if (currentPopup) {
    popup("dialog", false);
    //      }
    ig.game.dialogAction(value);
}

function pageInit() {
    noScroll();
    popup("shop", false);
    popup("boost", false);
    popup("dialog", false);
}

function zoomin() {
    $("#canvas").addClass("bigCanvas");
}

function fight() {
  var fbid1 = getPlayer('p1=')
  var fbid2 = getPlayer('p2=')
  //alert(' '+fbid1+fbid2)
getFriends(false, ig.game.fight, fbid2);
//    var d1 = { name: "p1", likes: 10, videos: 3 };
//    var d2 = { name: "p1", likes: 3, videos: 9 };
//    ig.game.fight( d1, d2);

}

</script>
  
    <script type="text/javascript" src="lib/plugins/pikkle/pikkle-utils.js"></script>
    <script type="text/javascript" src="lib/impact/impact.js"></script>
    <script type="text/javascript" src="lib/game/main.js"></script>
    <script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
      <script type="text/javascript"
    src="javascripts/picker.js"></script>

</head>

    <body onload="javascript:pageInit();">
      <div id="fb-root"></div>
  <div id="user-info"></div>
  <script>


    (function() {
        var e = document.createElement('script'); e.async = true;
        e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
        document.getElementById('fb-root').appendChild(e);
    }());


window.fbAsyncInit = function() {
    FB.init({ appId: '179548482130062', 
              status: true, 
              cookie: true,
              xfbml: true,
              oauth: true});

    FB.Event.subscribe('auth.statusChange', handleStatusChange);  
};


  
function login() {
    FB.login(function(response) { }, {scope:'user_likes,user_interests, friends_about_me,friends_activities,friends_birthday, friends_checkins, friends_education_history, friends_events, friends_games_activity, friends_groups, friends_hometown friends_interests, friends_likes, friends_location, friends_notes, friends_online_presence, friends_photo_video_tags, friends_photos, friends_questions, friends_relationship_details, friends_relationships, friends_religion_politics, friends_status, friends_subscriptions, friends_videos, friends_website, friends_work_history', });
}



  

function publishStory() {
    FB.ui({
        method: 'feed',
        name: 'I\'m building a social mobile web app!',
        caption: 'This web app is going to be awesome.',
        description: 'Check out Facebook\'s developer site to start building.',
        link: 'http://www.mattwkelly.com/icebreaker',
        picture: 'http://www.facebookmobileweb.com/hackbook/img/facebook_icon_large.png'
    }, 
          function(response) {
              console.log('publishStory response: ', response);
          });
    return false;
}

function sendRequest() {
    FB.ui({
        method: 'apprequests',
        message: 'Check out this awesome app!'
    }, 
          function(response) {
              console.log('sendRequest response: ', response);
          });
}

function handleStatusChange(response) {
    if (response.authResponse) {
        //console.log(response);
        updateUserInfo(response);
        //getCommonLikes(response);
    }
}

function updateUserInfo(response) {
    FB.api('/me&fields=likes,id,name', function(response) {
        document.getElementById('user-info').innerHTML = '<img src="https://graph.facebook.com/' + 
            response.id + '/picture">' + 
            response.name;
    });
}
  
</script>

  <div class="topNav">
    <a class='buyButton' href="javascript:fight()">fight</a>
    <a class='buyButton' href="/index-mobile">map</a>
    <a class='buyButton' href="javascript:goShop()">shop</a>
    <a class='buyButton' href="javascript:goUpgrade()">upgrade</a>  
    <a class='buyButton' href="javascript:popup('boost', true)">boost</a>
  </div>

  <div id="game">
    <canvas id="canvas" class="bigCanvas"></canvas>
  </div>

  <!-- shop -->
  <div id="shop" class="shopDiv">
    
    <table width='100%'>

      <tr>
        <td colspan='2'>
          <h2>shop!</h2>
        </td>
        <td>
          <a class="buyButton" href="javascript:popup('shop', false)">close</a> <p/>
        </td>
      </tr>

      
      <tr>
        <td>
          <img src="media/img/buildings/store-thumb.png"/>
        </td>
        <td>
          goodies in stock<br>
          10 coins
        </td>
        <td>
          <a class="buyButton" href="javascript:buyItem('store')">
            buy
          </a> 
        </td>
      </tr>
      
      <tr>
        <td>
          <img src="media/img/buildings/cafe-thumb.png"/>
        </td>
        <td>
          cute little cafe <br/>
          10 coins
        </td>
        <td>
          <a class="buyButton" href="javascript:buyItem('cafe')">
            buy
          </a>
        </td>
      </tr>

    </table>
    
  </div>
  
  <div id="boost" class="shopDiv">
    <h2>boosters</h2>
    <a class="buyButton" href="javascript:buyItem('boost1')">instant grow</a> <p/>
    <br/>
    <a class="buyButton" href="javascript:popup('boost', false)">close</a> <p/>
  </div>

  <div id="upgrade" class="shopDiv">
    <h2>upgrade</h2>
    <table>
      <tr>
        <td>
          <a class="buyButton" href="javascript:doUpgrade(true)">yes</a>
        </td>
        <td>
          <a class="buyButton" href="javascript:doUpgrade(false)">no</a>
        </td>
      </tr>
    </table>

    <br/>

  </div>

  <div id='dialog' class='shopDiv' style="visibility: hidden;" >
    <table>
      <tr><td colspan='2'>
        <div id="dialog_message"></div> <br></td></tr><tr>
        <td><a class="buyButton" href="javascript:dialogAction(true)">yes</a></td>
        <td><a class="buyButton" href="javascript:dialogAction(false)">no</a></td>
      </tr>
    </table>
  </div>

<script type="text/javascript">
  document.body.addEventListener('touchmove', function(e) { e.preventDefault(); window.scrollTo(0,1); }, false);
</script>
</body>
</html>
